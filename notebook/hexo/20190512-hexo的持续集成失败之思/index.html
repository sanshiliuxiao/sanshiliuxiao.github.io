<!DOCTYPE html><html lang="ZH-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="referrer" content="no-referrer"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="author" content="椎咲良田"><meta name="copyright" content="椎咲良田"><meta name="og:image" content="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/avatar.jpg"><meta name="og:type" content="website"><meta name="og:site_name" content="椎咲良田"><meta name="og:url" content="sanshiliuxiao.top"><meta name="og：title" content="椎咲良田"><meta name="theme-color" content="#b854d4"><title>椎咲良田</title><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/favicon.jpg" type="image/x-icon"><link rel="stylesheet" href="/css/index.css?version=2.0.0"><link rel="stylesheet" href="/font/fontello.css?version=2.0.0"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira+Mono|Noto+Serif+SC&amp;amp;display=swap"><link rel="canonical" href="//sanshiliuxiao.top"><link rel="dns-prefetch" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><script src="/lib/gitalk/gitalk.min.js"></script></head><body><div class="layout"><header><div class="header"><div class="mobile-bg" style="background-image:url(https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/mobile.png);"></div><h1 class="title">椎咲良田</h1><h2 class="subtitle">快走吧 趁风停止之前</h2><nav class="menu"><a class="menu-item pjax-main-link" href="/"><li><i class="icon-index"></i><span>首页</span></li></a><a class="menu-item pjax-main-link" href="/archives/"><li><i class="icon-archives"></i><span>归档</span></li></a><a class="menu-item pjax-main-link" href="/categories/"><li><i class="icon-categories"></i><span>分类</span></li></a><a class="menu-item pjax-main-link" href="/tags/"><li><i class="icon-tags"></i><span>标签</span></li></a><a class="menu-item pjax-main-link" href="/books/"><li><i class="icon-books"></i><span>书单</span></li></a><a class="menu-item pjax-main-link" href="/inspirations/"><li><i class="icon-inspiration"></i><span>灵感</span></li></a><a class="menu-item pjax-main-link" href="/friends/"><li><i class="icon-friends"></i><span>友链</span></li></a><a class="menu-item pjax-main-link" href="/about/"><li><i class="icon-about"></i><span>关于</span></li></a></nav></div></header><main><div class="main-wrapper"></div><div class="pjax-main-page"><div class="post"><article class="post-article"><div class="post-header"><img class="default-image" src="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/postDefaultImage .png"><div class="post-head"><div class="post-title-wrapper"><h1 class="post-title">hexo的持续集成失败之思</h1></div><div class="post-meta"><span class="post-date"><i class="icon-calendar"></i><span class="date timeago" datetime="2019-05-12T01:40:11.000Z"></span></span><span class="post-hot"><i class="icon-fire"></i><span class="leancloud_visitors" id="/notebook/hexo/20190512-hexo的持续集成失败之思/" data-flag-title="hexo的持续集成失败之思">热度<span class="leancloud-visitors-count">0</span>℃</span></span><span class="post-tags"><i class="icon-tag"></i><span class="tag">hexo</span><span class="tag">Travis</span></span><span class="post-categories"><i class="icon-bookmark-empty"></i><span class="category">笔记本</span><span class="category">hexo</span></span></div></div></div><div class="post-content"><div class="markdown"><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>这是一次失败的经历，花了将近两个小时，才知道原来自己想的方法，在特定的情况下是无法实现的，本文将简单的记录这次事情的前因后果。</p>
<p>如果要写出这次构建的整个流程细节的话，那还是算了吧，写文章还是很累的，一篇长文下来，一两个小时就过去了，尤其是针对这种实操性质的文章，写的更慢。而且对于自己产出的内容，一定要验证其正确性，文章内容需要进行复现，验证，而不是单单的写出来就完事。所以，还是好好当个<strong>快乐咸鱼</strong>吧。</p>
<h2 id="太长不看版"><a href="#太长不看版" class="headerlink" title="太长不看版"></a>太长不看版</h2><p>成功生成 gh-pages 分支后，却还是无法正常访问生成后的页面，查找其根本原因。在仓库的 <a href="https://help.github.com/en/articles/configuring-a-publishing-source-for-github-pages" target="_blank" rel="noopener">setting/Github Pages/Souce/Learn more</a> 中有一段话:</p>
<blockquote>
<p>You can configure GitHub Pages to publish your site’s source files from master, gh-pages, or a /docs folder on your master branch for Project Pages and other Pages sites that meet certain criteria.<br>If your site is a User or Organization Page that has a repository named username.github.io or orgname.github.io, you cannot publish your site’s source files from different locations. User and Organization Pages that have this type of repository name are only published from the master branch.</p>
</blockquote>
<p>翻译过来就是，你可以使用<code>master</code>分支、<code>gh-pages</code>分支、<code>/docs</code> 文件夹，这三种方式都能展示到 Github Pages。<strong>但是</strong>，你的仓库是 <code>username.github.io</code>的话，那么抱歉，你就只能对外展示 <code>master</code> 分支的内容。</p>
<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>之前，有使用过 vuepress 和 Travis CI ，来搭建一个简单的记事本的网页。访问 <a href="/talkSelf/20190313-vuepress初体验/">vuepress初体验</a> 了解更多。</p>
<p>昨儿，有人提到了博客备份很重要，于是就想到了使用 Travis CI，这样只需要使用 git 指令，上传整个博客文件夹（可以把之前的 public 文件夹删掉），而不是每次都执行一遍 hexo g -d，之后上传的 public 文件夹中的内容。这样就达到了即自动备份了目录，又能够自动进行博客的目的。</p>
<p>大概目录结构就是下面这样。</p>
<p><img src="1.png" alt></p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>在 <code>username.github.io</code> 的远程仓库中，存放上图中的所有文件，使用 Travis CI 对其进行持续集成。最终达到提交文件，更改 <code>master</code> 分支里的内容，同时 Travis CI 自动生成静态页面以及部署到 <code>gh-pages</code> 分支。</p>
<h2 id="经过"><a href="#经过" class="headerlink" title="经过"></a>经过</h2><p>嗯，最开始参照另外一篇博文 <a href="https://juejin.im/post/596e39916fb9a06baf2ed273" target="_blank" rel="noopener">如何快速搭建一个有域名且持续集成的hexo博客(2.0版)</a> 。花了大概半个小时，走了一遍整个流程。想的是如果别人已经写出来了，那么自己就能够很容易的顺着他的思路，也完成一遍。</p>
<p>但是很显然咱没有意识到到这个作者写出来的文章是有缺陷的，因为它的构建方法，是无法实现自动备份的功能，其本质原因是它的执行脚本里面依旧是把生成 public 文件夹上传到远程仓库，只不过不再需要自己手动生成，因此它的文章并不符合咱所想要实现的目标。</p>
<p>所以一切回到原点，于是开始尝试自己理解持续集成的流程，加上之前的心得，于是乎，自己就稍微改进了一下 <code>Travis.yml</code> 文件。最后，就有了下面的脚本，好嘛，这不就是跟之前的那个 vuepress 时写的脚本差不多。</p>
<pre><code class="yml">language: node_js
node_js: stable

# Travis-CI Caching
cache:
  directories:
    - node_modules

install:
  - npm install

script:
  - hexo clean
  - hexo g

deploy:
  provider: pages
  local-dir: public
  skip-cleanup: true
  github-token: $GH_TOKEN
  keep-history: true
  on:
    branch: master</code></pre>
<p>其中 $GH_TOKEN 需要先在 github 的 setting 中完成 <a href="https://github.com/settings/tokens" target="_blank" rel="noopener">Access Token的申请</a>。然后在 Travis 控制台中选定需要持续集成的远程仓库，同时进行设置，具体细节在上面提到的文章都中有说。</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>既然无法在 <code>username.github.io</code>分支上面实现自己的想法，那或许可以退而求其次，将博客迁移到其他某个分支比如 <code>blog</code> 上，再重复一遍持续集成的操作，借由 <code>username.github.io/blog</code> 访问博客，而 <code>username/github.io</code> 可以做一个引导页。</p>
<p>不过作为一名已经建立博客几个月的人来说，咱不得不放弃这种想法了，因为一旦进行迁移，之前所有的访问，留言都将失效，得不偿失。故此，咱也只能放弃这种想法了。</p>
<p>综合考虑，放弃直接在 <code>username.github.io</code> 上进行持续集成，依旧使用古老的<code>hexo g -d</code> 指令。<br>而至于备份，可以新建一个私有仓库，对博客目录下文件进行 <code>git</code> 跟踪、保存。<br><code>git</code> 和 <code>hexo-deployer-git</code>插件 不会产生冲突，因为在根目录下的 <code>.gitignore</code> 可以设置忽略的文件。</p>
<pre><code class="cmd">.DS_Store
Thumbs.db
db.json
*.log
node_modules/
public/
.deploy*/</code></pre>
</div></div></article></div><div id="gitalk"></div><script>var gitalk = new Gitalk({
    clientID: '921d6f0be7c36e212658',
    clientSecret: '2614ce5f405d03d99d9b76da0dc0a6f75b376bd9',
    id: '2019-05-12 09:40:11',
    repo: 'comments',
    owner: 'sanshiliuxiao',
    admin: 'sanshiliuxiao'
})
gitalk.render('gitalk')</script></div><div class="pjax-main-loading loading"><img class="loading-image" src="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/loading.gif"></div></main><footer><div class="footer site-info"><p><i class="icon-copyright"></i><span>2018</span>&minus;<span>2020</span>&nbsp;&nbsp;&nbsp;<i class="icon-heart"></i>&nbsp;&nbsp;<span>椎咲良田</span></p><p><a href="https://github.com/sanshiliuxiao/hexo-theme-aurora.git" target="_blank">hexo-theme-Aurora</a>&nbsp; | &nbsp;快走吧 趁风停止之前</p></div></footer></div><div class="bg"><div class="pc-dynamic-bg"><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/1.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/2.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/3.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/4.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/5.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/6.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/7.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/8.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/9.jpg"></span></div></div><span class="back-to-top"></span><div class="leancloud"><script src="/js/third-party/leancloud.min.js?version=2.0.0"></script><div class="leancloud-app-id" leancloud-app-id="QAIKomD08e9fmVRQP4tkzUDf-MdYXbMMI"></div><div class="leancloud-app-key" leancloud-app-key="vi0TViY0HvYocUR3HxKGd1l9"></div><div class="leancloud-app-hot"></div><div class="leancloud-app-visitor"></div></div><link rel="stylesheet" href="/lib/APlayer/APlayer.min.css"><script src="/lib/APlayer/APlayer.min.js"></script><div id="aplayer"></div><script>let list = JSON.parse('[{"name":"Once more","artist":"阿保剛","url":"https://files.catbox.moe/13boxb.mp3","cover":"https://i.loli.net/2019/04/18/5cb87157c617e.jpg"},{"name":"All or None","artist":"阿保剛","url":"https://files.catbox.moe/4x69y9.mp3","cover":"https://i.loli.net/2019/04/18/5cb87157b537a.jpg"},{"name":"Karma","artist":"阿保剛","url":"https://files.catbox.moe/r5dsuh.mp3","cover":"https://i.loli.net/2019/04/18/5cb871583cfb7.jpg"},{"name":"星の奏でる歌","artist":"阿保剛","url":"https://files.catbox.moe/m1wd57.mp3","cover":"https://i.loli.net/2019/04/18/5cb871585123b.jpg"}]')
  const ap = new APlayer({
      container: document.getElementById('aplayer'),
      theme: '#b28fce',
      audio: list,
      fixed: true
  });
  ap.list.show()
</script><script src="/js/third-party/jquery.min.js?version=2.0.0"></script><script src="/js/third-party/isMobile.min.js?version=2.0.0"></script><script src="/js/third-party/timeago.min.js?version=2.0.0"></script><script src="/js/third-party/pjax.min.js?version=2.0.0"></script><script src="/js/third-party/zooming.min.js?version=2.0.0"></script><script src="/js/third-party/backstretch.min.js?version=2.0.0"></script><script src="/js/highlight.min.js?version=2.0.0"></script><script src="/js/index.js?version=2.0.0"></script></body></html>