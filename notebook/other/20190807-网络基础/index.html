<!DOCTYPE html><html lang="ZH-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="referrer" content="no-referrer"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="author" content="椎咲良田"><meta name="copyright" content="椎咲良田"><meta name="og:image" content="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/avatar.jpg"><meta name="og:type" content="website"><meta name="og:site_name" content="椎咲良田"><meta name="og:url" content="sanshiliuxiao.top"><meta name="og：title" content="椎咲良田"><meta name="theme-color" content="#b854d4"><title>椎咲良田</title><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/favicon.jpg" type="image/x-icon"><link rel="stylesheet" href="/css/index.css?version=2.0.0"><link rel="stylesheet" href="/font/fontello.css?version=2.0.0"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira+Mono|Noto+Serif+SC&amp;amp;display=swap"><link rel="canonical" href="//sanshiliuxiao.top"><link rel="dns-prefetch" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><script src="/lib/gitalk/gitalk.min.js"></script><script src="/lib/valine/Valine.min.js"> </script></head><body><div class="layout"><header><div id="header"><div class="mobile-bg" style="background-image:url(https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/mobile.png);"></div><h1 class="title">椎咲良田</h1><h2 class="subtitle">快走吧 趁风停止之前</h2><nav class="menu"><a class="menu-item pjax-main-link" href="/"><li><i class="icon-index"></i><span>首页</span></li></a><a class="menu-item pjax-main-link" href="/archives/"><li><i class="icon-archives"></i><span>归档</span></li></a><a class="menu-item pjax-main-link" href="/categories/"><li><i class="icon-categories"></i><span>分类</span></li></a><a class="menu-item pjax-main-link" href="/tags/"><li><i class="icon-tags"></i><span>标签</span></li></a><a class="menu-item pjax-main-link" href="/books/"><li><i class="icon-books"></i><span>书单</span></li></a><a class="menu-item pjax-main-link" href="/inspirations/"><li><i class="icon-inspiration"></i><span>灵感</span></li></a><a class="menu-item pjax-main-link" href="/friends/"><li><i class="icon-friends"></i><span>友链</span></li></a><a class="menu-item pjax-main-link" href="/about/"><li><i class="icon-about"></i><span>关于</span></li></a></nav></div></header><main><div class="main-wrapper"></div><div class="pjax-main-page"><div class="post"><article class="post-article"><div class="post-header"><img class="default-image" src="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/postDefaultImage .png"><div class="post-head"><div class="post-title-wrapper"><h1 class="post-title">网络基础</h1></div><div class="post-meta"><span class="post-date"><i class="icon-calendar"></i><span class="date timeago" datetime="2019-08-07T02:00:20.000Z"></span></span><span class="post-hot"><i class="icon-fire"></i><span class="leancloud_visitors" id="/notebook/other/20190807-网络基础/" data-flag-title="网络基础">热度<span class="leancloud-visitors-count">0</span>℃</span></span><span class="post-tags"><i class="icon-tag"></i><span class="tag">网络</span></span><span class="post-categories"><i class="icon-bookmark-empty"></i><span class="category">笔记本</span></span></div></div></div><div class="post-content heti"><div class="markdown"><p>前几天，收到上次的 RPG 游戏的推送， 整个第一季大概就只需要半天时间就能够走完整个游戏。这个游戏的内容包括一些比较流行的梗，很简短的一些游戏剧情，还有就是一些基础的网络方面的知识。</p>
<p>游戏的首页是这样的，是不是很有 galgame 的风格。</p>
<p><img src="1.png" alt></p>
<p>不过当咱进入游戏之后，它的风格就真的很 RPG。</p>
<p><img src="2.png" alt></p>
<p>在之后的游戏剧情里面出现的学习面板，就跟正常的文档页面和视频页面差不多了，灰色表示还在开发之中。</p>
<p><img src="3.png" alt></p>
<p>整体来说跟预期有些出入，但还是能接受的。</p>
<h3 id="网络传输协议"><a href="#网络传输协议" class="headerlink" title="网络传输协议"></a>网络传输协议</h3><p>如果我们把网络传输比作寄快递，那就不是寄一封信，更像是寄一栋房子。那我们会经历哪些问题呢？</p>
<ul>
<li>需要目标地址 （寻址和路由）</li>
<li>需要一条到达目标地址的路 （数据链路）</li>
<li>房子需要拆装分箱 （分片）</li>
<li>箱子需要进行编号 （序列码）</li>
<li>箱子需要装到车上 （封装）</li>
<li>车队运输时可能堵车 （拥塞控制）</li>
<li>每一车的箱子是否完整 （错误检测和校正）</li>
<li>路上总会有丢失和损耗的部分，需要处理 （数据重发）</li>
<li>到底目的地，需要拆箱，将每一部分重新组装 （重组）</li>
</ul>
<p>因此，我们需要一个严格的流程来保障安全，提高效率，这就是<strong>协议</strong>，目前最主流的网络协议是 TCP/IP 协议族。注意<strong>协议族</strong>的意思是一系列的协议，而不是仅仅一个协议。协议族将网络分成四层，每一层负责不同的逻辑。</p>
<h3 id="四层模型"><a href="#四层模型" class="headerlink" title="四层模型"></a>四层模型</h3><p><img src="4.png" alt></p>
<p>网络接口层：主要解决设备驱动和网络接口之类的问题，<br>网络互连层：IP 协议就是在这一层，用于<strong>定位</strong>和<strong>寻址</strong>，同时还有辅助 IP 协议完成工作的 ARP 协议；<br>传输层：处理网络传输的问题， UDP 和 TCP 协议就工作在这一层<br>应用层：各类应用程序使用的协议，如 HTTP、DNS、FTP等协议</p>
<h4 id="各层间的分工"><a href="#各层间的分工" class="headerlink" title="各层间的分工"></a>各层间的分工</h4><p><img src="5.png" alt><br><img src="6.png" alt></p>
<p>数据从发送方应用层发送出去，每往下一层，就给数据包裹上一层 Header， 当传输到接收方的 网络接口层时，每往上一层，就去掉对应的 Header ，最终接收方，就能够获取到数据。每一层最核心的 Header 如下图表示。</p>
<p><img src="7.png" alt></p>
<h3 id="网络接口层"><a href="#网络接口层" class="headerlink" title="网络接口层"></a>网络接口层</h3><p>一个网卡的MAC地址： <code>00-05-5D-E8-0F-A3</code></p>
<p>电脑通过网卡进行网络连接，每一块网卡有一个卡商设定的MAC地址（也称物理地址），这个地址是设备的唯一标识。理论上来说，它作为设备的唯一标识不应该也不可能重复，但还是可以通过某些方法进行修改，不过只要接入同一个网络的设备的MAC地址不重复，就不会出现问题。</p>
<p>上面提到当发送方的数据经过网络接口层时，会被添加上 对应的 Header。最核心的一部分是 目标 MAC地址，源MAC地址，类型，FCS(帧检验序列)</p>
<p><img src="8.png" alt></p>
<h3 id="网络互联层"><a href="#网络互联层" class="headerlink" title="网络互联层"></a>网络互联层</h3><p>IP 由32位数字组成（当然是IPv4），分为<strong>网络标识</strong>和<strong>主机标识</strong>，通过<strong>子网掩码</strong>可以确定那部分是网络标识，哪部分是主机标识。 IP 地址分为共有地址和私有地址，共有地址需要向 Inter NIC进行申请，而私有地址属于非注册地址，可以专门为组织内部使用。</p>
<p><img src="9.png" alt></p>
<h4 id="同一内网的数据传输"><a href="#同一内网的数据传输" class="headerlink" title="同一内网的数据传输"></a>同一内网的数据传输</h4><p>两台电脑在同一个网络中，通过交换机进行连接。当一台机器想要发送数据给另一台机器时，可以知道另一台机器的 IP 地址（比如浏览器输入），但是不知道另一台机器的 MAC 地址。所以需要向向交换机发送一个 ARP 广播进行查询，交换机接收到 ARP 请求，就会向所有的电脑转发这个广播，另一台机器会接收到这个广播，就会进行 ARP 响应。这样就可以知道另一台机器的 MAC 地址，能够把数据发送出去。</p>
<p><img src="10.png" alt><br><img src="11.png" alt></p>
<h4 id="网络间的数据传输"><a href="#网络间的数据传输" class="headerlink" title="网络间的数据传输"></a>网络间的数据传输</h4><p>不在同一网络间的电脑进行数据传输比较复杂，因为需要经过交换机，路由器等多种设备，但是本质上的传输过程还是不变。</p>
<p>因为两台电脑处于不同的网络中，因此当一台机器想要发送数据给另一台机器时，会发现另一台机器的 IP 不在同一个网段中，所以它会先发给网关，可是它又不知道网关的 MAC 地址，于是它要先发送 ARP 查询，获取到网关的 MAC， 这样数据就先发送到网关，网关会查询路由表，看看目标电脑的 IP 地址是在哪里，同样它会发送 ARP 查询，看看下一步应该将数据发送到哪里去，获得到 MAC 地址后，<strong>它会修改数据包里面的接收端的 MAC 地址</strong>， 最后通过这样接力的方式，就能够将数据包发送到另一台电脑上了。</p>
<p><img src="12.png" alt><br><img src="13.png" alt><br><img src="14.png" alt></p>
<h3 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h3><p>数据从网络传输到电脑上，那这些数据属于哪些程序呢？这就由端口决定了。一台电脑上的一个端口只能被一个程序占用，当被占用时，其他程序是无法使用的，当然如果占用端口的程序结束了，那么其他程序就可以使用这个端口了。</p>
<p>常用的端口：</p>
<ul>
<li>21： FTP 文件传输服务</li>
<li>22： SSH 命令行远程登录</li>
<li>25： SMTP 邮件发送服务</li>
<li>80： HTTP 网站服务</li>
<li>110： POP3 邮件接收服务</li>
<li>139： SMB SAMBA共享</li>
<li>143： IMAP 邮件接收服务</li>
<li>443： HTTP 加密网站服务</li>
<li>3306： MySQL 数据库服务</li>
<li>3389： RDP 远程桌面服务</li>
<li>6379： Redis 缓存服务器</li>
<li>8080： Proxy 代理服务器</li>
</ul>
<h4 id="UDP-协议"><a href="#UDP-协议" class="headerlink" title="UDP 协议"></a>UDP 协议</h4><p>UDP 协议相对来说比 TCP 协议更简单， UDP Header 只有四部分，分别是：源端口、目标端口、长度、校验和。 校验和是通过将数据累加得到的一个特征值，如果数据有损坏或丢失，那么校验和可能就对不上，说明这个数据包有问题。</p>
<p><img src="15.png" alt></p>
<p>UDP 因为非常简单，所以它非常快，同时它也存在着丢包的问题。UDP协议是不会自动处理数据的问题，很多的处理细节都留给应用进行处理，比如 UDP 不会自动把包拼起来，也不做拥塞控制，如果网络拥堵，它也不会进行调节。因为这个协议传输数据的速度很快，所以 UDP 协议常常被使用在直播等场景，因为人们最希望看到的是最新的画面。</p>
<h3 id="TCP-协议"><a href="#TCP-协议" class="headerlink" title="TCP 协议"></a>TCP 协议</h3><p>TCP 协议可以看做 UDP 协议的增强版，它强化的数据传输时的可靠性，这样应用可以少操心数据传输的事情，可以将精力放到自己的业务逻辑上。</p>
<p>TCP Header 比 UDP Header 复杂很多。值得注意的是， TCP 的校验和是头部和数据部分的值的和，然后求反。TCP Header还多了<strong>序列码</strong>、<strong>响应码</strong>、<strong>标志位</strong>等信息。序列码和响应码可以对要发送的数据进行编号，标记它们的顺序，这样在网络延迟、并行发送的情况下才不会出错。</p>
<p><img src="16.png" alt><br><img src="17.png" alt></p>
<h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><p>FTP 可以很方便的共享那些不会经常被修改的数据，如电影，音乐等。但如果某些资料经常被修改，那每次都要去下载一遍，岂不是很麻烦，于是伟大的万维网诞生了。</p>
<p>万维网的三个核心技术：</p>
<ul>
<li>URI： 统一资源标识符，用于描述哪台服务器上有哪些东西，用于定位。</li>
<li>HTML： 超文本标记语言，用于标记文本，最核心的是能够在浏览一个页面时，通过点击操作跳转到其他页面。</li>
<li>HTTP： 超文本传输协议，描述传输细节，比如跳转时参数是如何进行传递。</li>
</ul>
<p>我们更多的知道 URL（统一资源定位符），而不是URI，那它们之间存在着怎样的关系呢？答案就是 URI 包含了 URL。</p>
<p>HTTP协议是非常重要的协议，几乎是整个 Web 编程的基础。HTTP 协议的最大特点是<strong>无状态</strong>，客户端向服务端发送一个请求，服务端收到请求后返回一个响应，整个过程非常简单。所有的请求，服务器都会当成新的请求，也就是说服务端不会维护客户端的信息，这就是无状态。（<strong>当然肯定会有办法让服务器记录状态</strong>）。</p>
<p>我们把 HTTP 协议传输的内容称为 HTTP message（报文），报文分为两种，一种是 Request（请求），告诉服务器想要什么；一种是 Response（响应），服务器返回的内容。这两种报文都需要遵从报文的基本格式。如果是请求，那么消息头里面就是 request header 相关字段，同样，如果是响应，那么消息头里面就是 response header的相关字段，还有一些 request 和 response 都能有的字段，我们称为 <strong>entity header</strong>。</p>
<p><img src="18.png" alt><br><img src="19.png" alt></p>
<h4 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h4><p><img src="20.png" alt></p>
<p>在 HTTP/1.1 协议中，所有的请求头，除了 Host 外，都是可选的。图中 GET 被称为 method（请求方法），请求方法有很多，但最常用的是：GET、POST 和 OPTIONS；其他的一些方法是：HEAD、PUT、DELETE、TRACE、CONNECT、PATCH。</p>
<p>常见的请求头字段： </p>
<ul>
<li>Referrer 请求发起页面的地址</li>
<li>User-Agent 客户端信息 </li>
<li>Host 主机域名</li>
<li>Max-forward 请求最大转发次数</li>
</ul>
<h4 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h4><p><img src="21.png" alt></p>
<p>Response中存在状态码，比如图中的 200，它表示成功。状态码主要有五类： 1xx（响应信息提示）、2xx（成功）、3xx（重定向）、4xx（客户端错误）、5xx（服务端错误）。</p>
<p>常见的响应头字段： </p>
<ul>
<li>ETage Entity的唯一编码，修改后更新</li>
<li>Retry-after N秒后重试</li>
<li>Location 转向到</li>
<li>Server Web Server 相关信息</li>
</ul>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>在 message header 中除了可以分别有请求头字段和响应头字段，还可以包含一些实体头字段。<br>常用的实体头字段： </p>
<ul>
<li>Allow 支持的 HTTP 支持的方法</li>
<li>Expires 过期时间（秒）</li>
<li>Content-Encoding  编码格式 如 gzip/defalte</li>
<li>Content-Language 语言编码格式 如 zh-cn</li>
<li>Content-Length 内容长度（字节）</li>
<li>Content-Type 媒体类型，如 text/html; charset=UTF-8）</li>
</ul>
<p>我们现在的字符集在绝大多数情况下都是使用的 UTF-8 格式。</p>
<p>常用的 MIME 类型 左边深蓝色是表示对应哪些文档，右边是 MIME 类型名（<a href="http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types" target="_blank" rel="noopener">所有的 MIME 类型在这里</a>）。</p>
<p><img src="22.png" alt></p>
<p>在 HTTP/1.1 中引入了 Keep-Alive（长连接），因为在 http/1.0 中每次进行请求，都会进行 TCP 连接，这样就会浪费大量的时间，因此在新版本里面出现了长连接来加快速度。</p>
<p>内容协商：服务器可以根据客户端的请求里面的一些特定字段，来发送特定的内容。</p>
<p>部分内容获取： 上次取了一部分，这次想取第二部分。</p>
<p>按条件获取：根据某些条件，服务费返回不同的数据。</p>
<p>Basic认证： 在客户端发送请求时带上 cookie，这样服务端就能知道它是谁了。</p>
<p><img src="23.png" alt></p>
<p>多内容分块传输：当发送的数据中既有表单，又有上传的文件，这个时候就需要使用 multipart，原理就是在一堆数据之间加上分隔符，然后把数据分成一段一段，每一段放置一些信息，最后由服务端根据这些信息完整的拼出数据。</p>
<p><img src="24.png" alt></p>
<h2>Google广告</h2><div class="google-ads-post-wrapper"><div class="google-ads-content"><div class="google-seat"><p>假装这里有广告</p></div></div></div></div></div></article></div><div id="gitalk"></div><script>var gitalk = new Gitalk({
    clientID: 'df197d1e1761f7b45688',
    clientSecret: 'cfbd1df2464d6ce367281fdc437d60701867b30a',
    id: '2019-08-07 10:00:20',
    repo: 'comments',
    owner: 'sanshiliuxiao',
    admin: 'df197d1e1761f7b45688'
})
gitalk.render('gitalk')</script></div><div class="pjax-main-loading loading"><img class="loading-image" src="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/loading.gif"></div></main><footer><div class="footer site-info"><p><i class="icon-copyright"></i><span>2018</span>&minus;<span>2021</span>&nbsp;&nbsp;&nbsp;<i class="icon-heart"></i>&nbsp;&nbsp;<span>椎咲良田</span></p><p><a href="https://github.com/sanshiliuxiao/hexo-theme-aurora.git" target="_blank">hexo-theme-Aurora</a>&nbsp; | &nbsp;快走吧 趁风停止之前</p></div></footer></div><div id="sakura-panel"><img class="sakura-icon" src="https://i.loli.net/2020/12/27/rPA2XaEJsnq5UIC.png" alt="sakura"><div class="sakura-mask"></div><div class="sakura-container"><div class="wrapper"><div class="short-line"><div class="line"></div><div class="line"></div></div><div class="main"><div class="body"><div class="swiper-wrapper"><ul class="swiper"><li class="swiper-item"><div class="header"><h2>联系方式</h2></div><div class="container"><div class="item"><h3>Q Q</h3><img class="qr-code" src="/images/qq.png"></div><div class="item"><h3>微信</h3><img class="qr-code" src="/images/vx.png"></div></div></li></ul></div></div><div class="footer"><p class="like"><span>已有 </span><span class="like-num leancloud-app-like">0</span><span> 人点赞了哦！</span></p><div class="star" data-title="点赞一下 (&lt;ゝω・)☆"></div></div></div><div class="long-line"><div class="line"></div><div class="line"></div></div></div></div></div><div class="bg"><div class="pc-dynamic-bg"><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/1.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/2.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/3.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/4.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/5.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/6.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/7.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/8.jpg"></span><span class="image" data-image="https://cdn.jsdelivr.net/gh/sanshiliuxiao/blog-static/theme/9.jpg"></span></div></div><span class="back-to-top"></span><div class="leancloud"><script src="/js/third-party/leancloud.min.js?version=2.0.0"></script><div class="leancloud-app-id" leancloud-app-id="QAIKomD08e9fmVRQP4tkzUDf-MdYXbMMI"></div><div class="leancloud-app-key" leancloud-app-key="vi0TViY0HvYocUR3HxKGd1l9"></div><div class="leancloud-app-hot"></div><div class="leancloud-app-visitor"></div></div><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" data-ad-client="ca-pub-9441161448418285"></script><div class="google-ads-ad-client" data-ads-ad-client="ca-pub-9441161448418285"></div><div class="google-ads-post-page" data-ads-solt="3867936552"></div><div class="google-ads-about-page" data-ads-solt="6860833347"></div><link rel="stylesheet" href="/lib/APlayer/APlayer.min.css"><script src="/lib/APlayer/APlayer.min.js"></script><div id="aplayer"></div><script>let list = JSON.parse('[{"name":"Once more","artist":"阿保剛","url":"https://files.catbox.moe/13boxb.mp3","cover":"https://i.loli.net/2019/04/18/5cb87157c617e.jpg"},{"name":"All or None","artist":"阿保剛","url":"https://files.catbox.moe/4x69y9.mp3","cover":"https://i.loli.net/2019/04/18/5cb87157b537a.jpg"},{"name":"Karma","artist":"阿保剛","url":"https://files.catbox.moe/r5dsuh.mp3","cover":"https://i.loli.net/2019/04/18/5cb871583cfb7.jpg"},{"name":"星の奏でる歌","artist":"阿保剛","url":"https://files.catbox.moe/m1wd57.mp3","cover":"https://i.loli.net/2019/04/18/5cb871585123b.jpg"}]')
  const ap = new APlayer({
      container: document.getElementById('aplayer'),
      theme: '#b28fce',
      audio: list,
      fixed: true
  });
  ap.list.show()
</script><script src="/js/third-party/jquery.min.js?version=2.0.0"></script><script src="/js/third-party/isMobile.min.js?version=2.0.0"></script><script src="/js/third-party/timeago.min.js?version=2.0.0"></script><script src="/js/third-party/pjax.min.js?version=2.0.0"></script><script src="/js/third-party/zooming.min.js?version=2.0.0"></script><script src="/js/third-party/backstretch.min.js?version=2.0.0"></script><script src="/js/highlight.min.js?version=2.0.0"></script><script src="/js/index.js?version=2.0.0"></script></body></html>